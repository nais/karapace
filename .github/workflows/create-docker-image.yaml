name: Create docker image

on:
  push:
    branch: main
    paths:
      - karapace_config.json
      - launcher.json
      - '.github/workflows/**'

jobs:
  docker:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Build docker image
      run: |
        docker build --tag ghcr.io/nais/nais-karapace:latest .
    - name: Run test
      run: |
        echo "THIS IS CURRENTLY A NO-OP!!!"
    - name: Login to GitHub Packages Docker Registry
      uses: docker/login-action@ab80d026d4753220c4243394c07c7d80f9638d06 # Use commit-sha1 instead of tag for security concerns
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    - name: Push Docker image
      run: |
        docker push ghcr.io/nais/nais-karapace:latest
